:root{
  --mm:3.7795275591px; --paper-w-mm:148; --paper-h-mm:210;
  --pad:6%; --ink:#111827; --muted:#6b7280;
  --fs:1.02rem; --lh:1.8;
  --flip-duration:.68s; --single-flip-duration:.58s;
  --hard-flip-duration:.82s; --hard-single-duration:.72s;
  --flip-ease:cubic-bezier(.33,1,.68,1);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:#e6ebff;
  font-family:'Noto Sans TC',system-ui,-apple-system,Segoe UI,sans-serif;
  background:#000 url('https://shierusha.github.io/school-battle/teachers/img/8.webp') center top / cover no-repeat fixed;
}

/* 上方導覽 */
.appbar{
  position:sticky; 
  top:0; 
  z-index:100;
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  gap:10px;
  padding:10px 14px; 
  background:rgba(15,27,51,.85); 
  border-bottom:1px solid #223057;
}
.brand{display:flex;gap:.6rem;align-items:center;font-weight:700}
#bookTitle{outline:none}
#bookTitle[contenteditable="true"]{border-bottom:1px dashed #8aa1ff}
.tools{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.btn{
  background:#16244a;
  border:1px solid #3a4a78;
  color:#fff;
  padding:5px 10px;
  border-radius:10px;
  cursor:pointer}
.btn.primary{background:#6f82ff;border-color:#6f82ff}
.btn.danger{background:#2a0f18;border-color:#6b1b2e;color:#ffb3c2}
.btn.ghost{background:#ffffff18;border-color:#ffffff33}
.btn:disabled{opacity:.5;cursor:default}

/* 工具列 & Dock */
.side{
  position:fixed;
  top:5%;
  display:flex;
  gap:8px;
  z-index:90}
.side.left{left:10px}
.side.right{right:10px}
.dock{position:fixed;left:0;right:0;bottom: 1%;display:flex;gap:10px;justify-content:center;z-index:90}
.dock:nth-of-type(1){bottom:10px}
.dock:nth-of-type(2){bottom:60px}

/* 舞台與紙張 */
.stage{display:grid;place-items:center;min-height:calc(100vh - 160px);padding:12px;position:relative;z-index:10;perspective:1400px;justify-content: center;}
.scaler{transform-origin:top center}
.papers{display:grid;grid-template-columns:1fr 1fr;gap:0;position:relative;}
.paper{
  position:relative; background:#fff; color:var(--ink);
  width:calc(var(--paper-w-mm)*var(--mm)); height:calc(var(--paper-h-mm)*var(--mm));
  box-shadow:0 8px 30px rgba(0,0,0,.25); overflow:hidden;
}
.paper.left{border-radius:10px 0 0 10px}
.paper.right{border-radius:0 10px 10px 0}

.tpl-cover-front{
  background:linear-gradient(130deg, #1f2c57, #101833 55%, #0b1229 100%);
  color:#f1f5ff;
  border-radius:14px;
  box-shadow:0 22px 55px rgba(8,15,35,.55);
}
.tpl-cover-front .page{padding:calc(var(--pad)*0.85);}
.tpl-cover-front::before{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  border:1px solid rgba(148,163,209,.35);
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.08);
  pointer-events:none;
}


/* 翻頁覆蓋層層級：白遮罩在下，翻頁在上 */
#flipOverlay .flipMask{ position:absolute; z-index:0; }
#flipOverlay .turn{ z-index:1; }

/* 長邊（橫放紙） */
.landscape .paper{
  width:calc(var(--paper-h-mm)*var(--mm));
  height:calc(var(--paper-w-mm)*var(--mm));
}
.landscape .tpl-illustration img{
  transform:rotate(90deg); object-fit:contain; width:auto; height:100%;
}

/* 單頁（不鎖手機，使用者可切） */
.single .papers{grid-template-columns:1fr}
.single .paper.left{display:none}
.single .paper.right{border-radius:10px}

/* 版心（6% 內縮）＋ Tab 寬度 */
.page{position:absolute; inset:0; padding:var(--pad); display:flex; flex-direction:column}
.body-text{
  flex:1; margin-top:.25rem; white-space:pre-wrap; line-height:var(--lh); font-size:var(--fs);
  overflow:hidden; outline:none; tab-size:2;
}
.ph:empty::before{content:attr(data-ph); color:#95a0c2}

/* 章節 */
.chapter-block{font-weight:700; font-size:1.25rem; line-height:1.6; margin-bottom:.6rem; outline:none}
.chapter-chip{position:absolute; top:var(--pad); font-size:.85rem; color:#6b7280}
.paper.left  .chapter-chip{ left:var(--pad) }
.paper.right .chapter-chip{ right:var(--pad) }
.page-no{position:absolute; bottom:var(--pad); font-variant-numeric:tabular-nums; color:#9aa3b2}
.paper.left  .page-no{ left:var(--pad) }
.paper.right .page-no{ right:var(--pad) }

/* 直排（章節/頁碼位置不變） */
.vertical .body-text{writing-mode:vertical-rl;text-orientation:upright;line-height:1.9}

/* 版型 */
.tpl-divider-light .page{ display:grid; place-items:center; text-align:center }
.tpl-divider-dark  { background:#555; color:#fff }
.tpl-divider-dark .page{ display:grid; place-items:center; text-align:center }
.tpl-illustration .page{ padding:0 }
.tpl-illustration img{ width:100%; height:100%; object-fit:cover; display:block }

/* 翻頁覆蓋層：雙頁＝高級；單頁＝簡易卷葉 */
#flipOverlay{ position:absolute; inset:0; pointer-events:none; z-index:20; perspective:1800px; }
.turn{ position:absolute; width:0;height:0; transform-style:preserve-3d; backface-visibility:hidden; border-radius:10px; overflow:visible; filter:drop-shadow(0 22px 45px rgba(15,23,42,.28)); will-change:transform,filter,opacity; }
.turn .face{ position:absolute; inset:0; backface-visibility:hidden; overflow:hidden; background:#fff; border-radius:inherit; box-shadow:inset 0 0 0 1px rgba(15,23,42,.08); }
.turn .face::after{ content:""; position:absolute; inset:0; pointer-events:none; border-radius:inherit; opacity:0; mix-blend-mode:screen; }
.turn .back{ transform: rotateY(180deg); }
.turn.from-right .front::after{ background:linear-gradient(90deg, rgba(255,255,255,.65) 0%, rgba(255,255,255,0) 48%, rgba(15,23,42,.22) 88%); animation:frontSheenRight var(--flip-duration) var(--flip-ease) both; }
.turn.from-left  .front::after{ background:linear-gradient(270deg, rgba(255,255,255,.65) 0%, rgba(255,255,255,0) 48%, rgba(15,23,42,.22) 88%); animation:frontSheenLeft  var(--flip-duration) var(--flip-ease) both; }
.turn .back::after{ background:radial-gradient(circle at 20% 20%, rgba(255,255,255,.35), transparent 55%); animation:backGlow var(--flip-duration) var(--flip-ease) both; mix-blend-mode:overlay; }
.foldShade{ position:absolute; inset:0; pointer-events:none; opacity:0; mix-blend-mode:multiply; border-radius:inherit; }
.turn.from-right .foldShade{ animation:foldShadeRight var(--flip-duration) var(--flip-ease) both; }
.turn.from-left  .foldShade{ animation:foldShadeLeft  var(--flip-duration) var(--flip-ease) both; }
.turn.hard{ border-radius:14px; filter:drop-shadow(0 26px 60px rgba(8,15,35,.42)); }
.turn.hard .face{ box-shadow:inset 0 0 0 1px rgba(15,23,42,.18); }
.turn.hard .face::after,.turn.hard .foldShade{ display:none; }
.turn.hard::before{
  content:"";
  position:absolute;
  top:0; bottom:0;
  width:12px;
  background:linear-gradient(90deg, rgba(12,18,35,.7), rgba(35,48,86,.2));
  transform-origin:left center;
  pointer-events:none;
  opacity:.85;
}
.turn.hard.from-right::before{ right:-1px; transform:rotateY(90deg) translateZ(6px); border-radius:3px; }
.turn.hard.from-left::before{ left:-1px; transform:rotateY(-90deg) translateZ(6px); border-radius:3px; }
@keyframes flipRightNext {
  0%{ transform:rotateY(0deg) rotateX(0deg) translateZ(0); }
  45%{ transform:rotateY(-98deg) rotateX(1.5deg) translateZ(6px); }
  100%{ transform:rotateY(-180deg) rotateX(0deg) translateZ(0); }
}
@keyframes flipLeftPrev  {
  0%{ transform:rotateY(0deg) rotateX(0deg) translateZ(0); }
  45%{ transform:rotateY(98deg) rotateX(1.5deg) translateZ(6px); }
  100%{ transform:rotateY(180deg) rotateX(0deg) translateZ(0); }
}
@keyframes hardFlipRightNext {
  0%{ transform:rotateY(0deg) rotateX(0deg) translateZ(0); }
  35%{ transform:rotateY(-60deg) rotateX(.6deg) translateZ(4px); }
  70%{ transform:rotateY(-138deg) rotateX(.4deg) translateZ(4px); }
  100%{ transform:rotateY(-180deg) rotateX(0deg) translateZ(0); }
}
@keyframes hardFlipLeftPrev {
  0%{ transform:rotateY(0deg) rotateX(0deg) translateZ(0); }
  35%{ transform:rotateY(60deg) rotateX(.6deg) translateZ(4px); }
  70%{ transform:rotateY(138deg) rotateX(.4deg) translateZ(4px); }
  100%{ transform:rotateY(180deg) rotateX(0deg) translateZ(0); }
}
@keyframes foldShadeRight {
  0%{ opacity:0; transform:translateX(0); }
  30%{ opacity:.55; transform:translateX(-6%); }
  60%{ opacity:.28; transform:translateX(-10%); }
  100%{ opacity:0; transform:translateX(-14%); }
}
@keyframes foldShadeLeft {
  0%{ opacity:0; transform:translateX(0); }
  30%{ opacity:.55; transform:translateX(6%); }
  60%{ opacity:.28; transform:translateX(10%); }
  100%{ opacity:0; transform:translateX(14%); }
}
@keyframes frontSheenRight {
  0%{ opacity:0; transform:translateX(-18%); }
  40%{ opacity:.45; transform:translateX(-6%); }
  70%{ opacity:.18; transform:translateX(4%); }
  100%{ opacity:0; transform:translateX(12%); }
}
@keyframes frontSheenLeft {
  0%{ opacity:0; transform:translateX(18%); }
  40%{ opacity:.45; transform:translateX(6%); }
  70%{ opacity:.18; transform:translateX(-4%); }
  100%{ opacity:0; transform:translateX(-12%); }
}
@keyframes backGlow {
  0%{ opacity:0.05; transform:translateX(0); }
  50%{ opacity:.25; transform:translateX(4%); }
  100%{ opacity:0; transform:translateX(8%); }
}

/* 單頁高級卷葉 */
.singleTurn{
  position:absolute; width:0;height:0; backface-visibility:hidden; overflow:hidden; background:#fff;
  box-shadow:0 14px 40px rgba(15,23,42,.28);
  border-radius:10px; transform-style:preserve-3d; will-change:transform,filter,opacity;
}
.singleTurn::after{
  content:""; position:absolute; inset:0; pointer-events:none; border-radius:inherit; opacity:0; mix-blend-mode:screen;
}
.singleTurn.from-right::after{ background:linear-gradient(100deg, rgba(255,255,255,.6) 0%, rgba(255,255,255,0) 45%, rgba(15,23,42,.22) 85%); animation:singleHighlightRight var(--single-flip-duration) var(--flip-ease) both; }
.singleTurn.from-left::after{ background:linear-gradient(260deg, rgba(255,255,255,.6) 0%, rgba(255,255,255,0) 45%, rgba(15,23,42,.22) 85%); animation:singleHighlightLeft var(--single-flip-duration) var(--flip-ease) both; }
.singleTurn.hard{ border-radius:14px; box-shadow:0 26px 60px rgba(8,15,35,.42); }
.singleTurn.hard::after{ display:none; }
.singleTurn.hard::before{
  content:"";
  position:absolute;
  top:0; bottom:0;
  width:12px;
  background:linear-gradient(90deg, rgba(12,18,35,.7), rgba(35,48,86,.2));
  transform-origin:left center;
  pointer-events:none;
  opacity:.85;
}
.singleTurn.hard.from-right::before{ right:-1px; transform:rotateY(90deg) translateZ(5px); border-radius:3px; }
.singleTurn.hard.from-left::before{ left:-1px; transform:rotateY(-90deg) translateZ(5px); border-radius:3px; }
@keyframes singleCurlNext {
  0%{ transform:rotateY(0deg) rotateX(0deg) translateZ(0); }
  45%{ transform:rotateY(-118deg) rotateX(1.4deg) translateZ(6px); }
  100%{ transform:rotateY(-170deg) rotateX(0deg) translateZ(0); }
}
@keyframes singleCurlPrev {
  0%{ transform:rotateY(0deg) rotateX(0deg) translateZ(0); }
  45%{ transform:rotateY(118deg) rotateX(1.4deg) translateZ(6px); }
  100%{ transform:rotateY(170deg) rotateX(0deg) translateZ(0); }
}
@keyframes hardSingleNext {
  0%{ transform:rotateY(0deg) rotateX(0deg) translateZ(0); }
  40%{ transform:rotateY(-70deg) rotateX(.4deg) translateZ(3px); }
  75%{ transform:rotateY(-150deg) rotateX(.2deg) translateZ(3px); }
  100%{ transform:rotateY(-180deg) rotateX(0deg) translateZ(0); }
}
@keyframes hardSinglePrev {
  0%{ transform:rotateY(0deg) rotateX(0deg) translateZ(0); }
  40%{ transform:rotateY(70deg) rotateX(.4deg) translateZ(3px); }
  75%{ transform:rotateY(150deg) rotateX(.2deg) translateZ(3px); }
  100%{ transform:rotateY(180deg) rotateX(0deg) translateZ(0); }
}
@keyframes singleHighlightRight {
  0%{ opacity:0; transform:translateX(-14%); }
  35%{ opacity:.48; transform:translateX(-4%); }
  65%{ opacity:.18; transform:translateX(6%); }
  100%{ opacity:0; transform:translateX(12%); }
}
@keyframes singleHighlightLeft {
  0%{ opacity:0; transform:translateX(14%); }
  35%{ opacity:.48; transform:translateX(4%); }
  65%{ opacity:.18; transform:translateX(-6%); }
  100%{ opacity:0; transform:translateX(-12%); }
}

@media (prefers-reduced-motion: reduce){
  .turn,
  .singleTurn{
    animation-duration:.001ms !important;
    animation-iteration-count:1 !important;
    transition-duration:.001ms !important;
    filter:none !important;
  }
  .turn .face::after,
  .singleTurn::after,
  .foldShade{ animation:none !important; opacity:0 !important; }
}




