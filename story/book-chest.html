<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>謝爾夏｜電子書櫃</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- 字體 -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
/* ========== Reset / Base ========== */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:#e6ebff;
  font-family:'Noto Sans TC',system-ui,-apple-system,Segoe UI,sans-serif;
  background:#000 url('https://shierusha.github.io/school-battle/teachers/img/8.webp') center top / cover no-repeat fixed;
}

/* 隱藏滾動條但保留滾動 */
html, body { overflow-y: auto; }
body { -ms-overflow-style: none; scrollbar-width: none; }
body::-webkit-scrollbar { width:0; height:0; }

/* ========== App Bar ========== */
.appbar{
  position:sticky; top:0; z-index:100;
  display:flex; justify-content:space-between; align-items:center; gap:10px;
  padding:10px 14px; background:rgba(15,27,51,.85); border-bottom:1px solid #223057;
  height: 30px;
}
.brand{display:flex;gap:.6rem;align-items:center;font-weight:700}
#bookTitle{outline:none}
#bookTitle[contenteditable="true"]{border-bottom:1px dashed #8aa1ff}
.tools{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

/* ========== 舞台區（保持你的版面） ========== */
.stage{
  position: absolute;
  left: 50%;
  top: 60px;
  transform: translateX(-50%);
  width: 90%;
  max-width: 1100px;
  height: 100vh;
}
.scaler{ position:relative; width:100%; }

/* ========== 你的按鈕樣式（原樣） ========== */
.btn{ background:#16244a; border:1px solid #3a4a78; color:#fff; padding:2px 10px; border-radius:10px; cursor:pointer }
.btn.primary{ background:#6f82ff; border-color:#6f82ff }
.btn.danger{ background:#2a0f18; border-color:#6b1b2e; color:#ffb3c2 }
.btn.ghost{ background:#4d4d4de0; border-color:#ffffff33 }
.side{ position:fixed; top:32px; display:flex; gap:8px; z-index:90 }
.side.left{ left:10px }
.side.right{ right:10px }
.dock{ position:fixed; left:0; right:0; bottom:1%; display:flex; gap:10px; justify-content:center; z-index:90 }

/* ========== 文字方向（外觀） ========== */
.mode-ltr .page{ writing-mode: horizontal-tb; }
.mode-rtl .page{ writing-mode: vertical-rl; text-orientation: upright; letter-spacing: 0.1em; }
.mode-ltr .single-page{ writing-mode: horizontal-tb; }
.mode-rtl .single-page{ writing-mode: vertical-rl; text-orientation: upright; letter-spacing: 0.1em; }

/* ===== BookFlip 必要 CSS（請勿移除） ===== */
.book, .book * { user-select:none; -webkit-user-select:none; }
.book { position:absolute; top:0; color:black; }
.paper {
  width:100%; height:100%;
  position:absolute; top:0; left:0;
  transform-style:preserve-3d;
  background:#FFF;
  border: 1px solid #555;
}
.page {
  width:100%; height:100%;
  position:absolute; top:0; left:0;
  display:flex;
  backface-visibility:hidden; -webkit-backface-visibility:hidden;
  padding: calc(16px * var(--scale, 1)); /* 內距跟字級一起縮放 */
}
.back { transform: rotateY(180deg); }
.paper.dir-ltr { transform-origin: left center; }
.paper.dir-rtl { transform-origin: right center; }

.single-stage { width:100%; height:100%; position:relative; overflow:hidden; }
.single-page  { width:100%; height:100%; position:absolute; top:0; left:0; display:flex; will-change:transform; background:#FFF; padding: calc(16px * var(--scale, 1)); }

/* 字級比例（方案2：非 transform） */
.book-scope { font-size: calc(16px * var(--scale, 1)); }

/* ========== 章節角標＋頁碼 ========== */
.page-meta { position: absolute; pointer-events: none; font-size: .85em; opacity: .8; }
.meta-chapter { max-width: 45%; }
.meta-page    { min-width: 2.5em; text-align: right; }
.meta-tl { top: 8px;  left: 10px; }
.meta-tr { top: 8px;  right: 10px; }
.meta-bl { bottom: 8px; left: 10px; }
.meta-br { bottom: 8px; right: 10px; }

/* ========== 四種頁型（底線版） ========== */
.page.page--divider_light,
.single-page.page--divider_light,
.page.page--divider_dark,
.single-page.page--divider_dark {
  display:flex; align-items:center; justify-content:center; text-align:center;
}
/* 不顯示角標 */
.page--divider_light .page-meta,
.page--divider_dark  .page-meta,
.page--illustration  .page-meta { display:none !important; }


/* 配色 */
.page.page--divider_light, .single-page.page--divider_light { background:#fff; color:#000; }
.page.page--divider_dark,  .single-page.page--divider_dark  { background:#555; color:#fff; }
/* 圖片滿版 */
.page.page--illustration, .single-page.page--illustration {
  background-size: cover; background-position: center; background-repeat: no-repeat; padding:0 !important;
}
  </style>
</head>

<body class="mode-ltr">
  <!-- 上方導覽 -->
  <div class="appbar">
    <div class="brand">書名:<span id="bookTitle" contenteditable="true">未命名書籍</span></div>
    <div class="tools">
      <div>
        <span>頁面數：</span><b id="lblCount">0</b>
        <span style="width:5px"></span>
      </div>
      <div>
        <button class="btn primary" id="btnSave">儲存</button>
        <button class="btn" id="btnBack">回書單</button>
      </div>
    </div>
  </div>

  <!-- 左側工具列（保留） -->
  <div class="side left">
    <button class="btn ghost" id="btnTOC" style="display:none">目錄</button>
    <button class="btn ghost" id="btnFontUp">A+</button>
    <button class="btn ghost" id="btnFontDown">A-</button>
    <button class="btn ghost" id="btnBold"><b>B</b></button>
    <button class="btn ghost" id="btnItalic"><i>I</i></button>
    <button class="btn ghost" id="btnUnderline"><u>U</u></button>
  </div>

  <!-- 右側工具列 -->
  <div class="side right">
    <button class="btn ghost" id="btnToggleDir">文字方向</button>
    <button class="btn ghost" id="btnToggleBind">長/短邊</button>
    <button class="btn ghost" id="btnToggleView">單/雙頁</button>
  </div>

  <!-- 中央舞台 -->
  <div class="stage">
    <div class="scaler" id="scaler">
      <div class="book" id="bookCanvas">
        <!-- ✅ 封面保留（插件不覆蓋） -->
        <div class="paper">
          <div class="page front">首頁</div>
          <div class="page back">全白空頁面</div>
        </div>
        <!-- 正文由 JS 追加 -->
      </div>
    </div>
  </div>

  <!-- 下方 Dock（保留你的按鈕） -->
  <div class="dock" style="bottom:34px;">
    <button class="btn ghost" id="btnleft">&lt;</button>
    <button class="btn" id="btnInsertChapter" style="display:none">插入章節</button>
    <button class="btn" id="btnInsertPage" style="display:none">插入白紙</button>
    <button class="btn danger" id="btnDeleteBlank" style="display:none">刪除白紙</button>
    <button class="btn ghost" id="btnright">&gt;</button>
  </div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://ogzpfrkwnqqaitytncla.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9nenBmcmt3bnFxYWl0eXRuY2xhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxODQzNzEsImV4cCI6MjA3MDc2MDM3MX0.Ls83xOXcKIW7FUcavr8_sOs37I18VGFWYNW3sNFRS24";
    const BOOK_ID = ""; // 無 ?book= 時可填固定 id
    const SB = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>

  <!-- 外掛：不注入 CSS，含 mounted 事件 -->
  <script src="book-flip.js"></script>
  <!-- 應用層（底線版） -->
  <script src="app.js"></script>
</body>
</html>
